<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 å¯’å‡æ—¥ç¨‹è§†è§‰ç®¡ç†</title>

    <!-- å¼•å…¥ Tailwind CSS ç”¨äºæ ·å¼ -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- å®šä¹‰ Import Mapï¼Œå‘Šè¯‰æµè§ˆå™¨ä»å“ªé‡ŒåŠ è½½ React å’Œå›¾æ ‡åº“ -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0"
        }
    }
    </script>

    <!-- å¼•å…¥ Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* é’ˆå¯¹æµè§ˆå™¨çš„æ»šåŠ¨æ¡æ ·å¼ä¼˜åŒ– */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
    </style>
</head>

<body class="bg-[#f1f5f9]">
    <div id="root"></div>

    <!-- ä¸»ç¨‹åºé€»è¾‘ -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import {
            Calendar,
            Plus,
            Trash2,
            Clock,
            GripVertical,
            Edit2,
            CheckCircle2,
            X,
            Sparkles,
            Loader2,
            Flag,
            Trophy,
            Coffee,
            Repeat,
            Layout,
            Eye,
            BarChart3
        } from 'lucide-react';

        /**
         * 2026 Winter Break Planner - Lunar Fixed & Visual Pro
         * Copy of provided code
         */

        const App = () => {
            // --- Constants ---
            const START_DATE_STR = '2026-01-19';
            const END_DATE_STR = '2026-03-01';
            const apiKey = "";

            // æ ¹æ® HTML æ–‡ä»¶åç”Ÿæˆå”¯ä¸€çš„å­˜å‚¨é”®
            // è¿™æ ·ä¸åŒçš„ HTML æ–‡ä»¶ä¼šå¯¹åº”ä¸åŒçš„æ•°æ®åº“ï¼Œé€‚åˆå¤šå­©å­å®¶åº­ä½¿ç”¨
            const getStorageKey = () => {
                // è·å–å½“å‰ HTML æ–‡ä»¶çš„å®Œæ•´è·¯å¾„
                const fullPath = window.location.pathname;
                // æå–æ–‡ä»¶åï¼ˆä¸å«è·¯å¾„ï¼‰
                const fileName = fullPath.substring(fullPath.lastIndexOf('/') + 1);
                // ç§»é™¤ .html æ‰©å±•å
                const baseName = fileName.replace('.html', '');
                // ç”Ÿæˆå­˜å‚¨é”®ï¼šwinter_tasks_2026_ + æ–‡ä»¶å
                return `winter_tasks_2026_${baseName}`;
            };

            // è·å–å½“å‰ä½¿ç”¨çš„æ•°æ®åº“åç§°ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
            const getDisplayName = () => {
                const fullPath = window.location.pathname;
                const fileName = fullPath.substring(fullPath.lastIndexOf('/') + 1);
                const baseName = fileName.replace('.html', '');
                // å¦‚æœæ–‡ä»¶ååŒ…å«è¿å­—ç¬¦æˆ–ä¸‹åˆ’çº¿ï¼Œæå–åé¢çš„éƒ¨åˆ†ä½œä¸ºåç§°
                const match = baseName.match(/[-_](.+)$/);
                return match ? match[1] : 'é»˜è®¤';
            };

            const STORAGE_KEY = getStorageKey();
            const DISPLAY_NAME = getDisplayName();

            const COLOR_CONFIG = {
                blue: { label: 'å›ºå®šè¯¾', bg: 'bg-blue-50', border: 'border-blue-500', text: 'text-blue-700', dot: 'bg-blue-500' },
                green: { label: 'è‡ªç”±ç»ƒä¹ ', bg: 'bg-green-50', border: 'border-green-500', text: 'text-green-700', dot: 'bg-green-500' },
                orange: { label: 'ä½“è‚²è¿åŠ¨', bg: 'bg-orange-50', border: 'border-orange-500', text: 'text-orange-700', dot: 'bg-orange-500' },
                purple: { label: 'å…´è¶£è‰ºæœ¯', bg: 'bg-purple-50', border: 'border-purple-500', text: 'text-purple-700', dot: 'bg-purple-500' },
                red: { label: 'ç´§æ€¥é‡è¦', bg: 'bg-red-50', border: 'border-red-500', text: 'text-red-700', dot: 'bg-red-500' }
            };

            // å®Œæ•´å†œå†æ•°æ®æ˜ å°„ (2026-01-19 åˆ° 2026-03-01)
            const LUNAR_MAP = {
                '2026-01-19': { d: 'è…Šæœˆåˆä¸€', m: null },
                '2026-01-20': { d: 'è…ŠæœˆåˆäºŒ', m: null },
                '2026-01-21': { d: 'è…Šæœˆåˆä¸‰', m: null },
                '2026-01-22': { d: 'è…Šæœˆåˆå››', m: null },
                '2026-01-23': { d: 'è…Šæœˆåˆäº”', m: null },
                '2026-01-24': { d: 'è…Šæœˆåˆå…­', m: null },
                '2026-01-25': { d: 'è…Šæœˆåˆä¸ƒ', m: null },
                '2026-01-26': { d: 'è…Šæœˆåˆå…«', m: 'è…Šå…«' },
                '2026-01-27': { d: 'è…Šæœˆåˆä¹', m: null },
                '2026-01-28': { d: 'è…Šæœˆåˆå', m: null },
                '2026-01-29': { d: 'è…Šæœˆåä¸€', m: null },
                '2026-01-30': { d: 'è…ŠæœˆåäºŒ', m: null },
                '2026-01-31': { d: 'è…Šæœˆåä¸‰', m: null },
                '2026-02-01': { d: 'è…Šæœˆåå››', m: null },
                '2026-02-02': { d: 'è…Šæœˆåäº”', m: null },
                '2026-02-03': { d: 'è…Šæœˆåå…­', m: null },
                '2026-02-04': { d: 'è…Šæœˆåä¸ƒ', m: 'ç«‹æ˜¥' },
                '2026-02-05': { d: 'è…Šæœˆåå…«', m: null },
                '2026-02-06': { d: 'è…Šæœˆåä¹', m: null },
                '2026-02-07': { d: 'è…ŠæœˆäºŒå', m: null },
                '2026-02-08': { d: 'è…Šæœˆå»¿ä¸€', m: null },
                '2026-02-09': { d: 'è…Šæœˆå»¿äºŒ', m: null },
                '2026-02-10': { d: 'è…Šæœˆå»¿ä¸‰', m: 'å°å¹´', icon: <Coffee size={12} /> },
                '2026-02-11': { d: 'è…Šæœˆå»¿å››', m: null },
                '2026-02-12': { d: 'è…Šæœˆå»¿äº”', m: null },
                '2026-02-13': { d: 'è…Šæœˆå»¿å…­', m: null },
                '2026-02-14': { d: 'è…Šæœˆå»¿ä¸ƒ', m: 'æƒ…äººèŠ‚' },
                '2026-02-15': { d: 'è…Šæœˆå»¿å…«', m: null },
                '2026-02-16': { d: 'è…Šæœˆä¸‰å', m: 'é™¤å¤•', icon: <Flag size={12} /> },
                '2026-02-17': { d: 'æ­£æœˆåˆä¸€', m: 'æ˜¥èŠ‚', icon: <Trophy size={12} /> },
                '2026-02-18': { d: 'æ­£æœˆåˆäºŒ', m: null },
                '2026-02-19': { d: 'æ­£æœˆåˆä¸‰', m: 'é›¨æ°´' },
                '2026-02-20': { d: 'æ­£æœˆåˆå››', m: null },
                '2026-02-21': { d: 'æ­£æœˆåˆäº”', m: null },
                '2026-02-22': { d: 'æ­£æœˆåˆå…­', m: null },
                '2026-02-23': { d: 'æ­£æœˆåˆä¸ƒ', m: null },
                '2026-02-24': { d: 'æ­£æœˆåˆå…«', m: null },
                '2026-02-25': { d: 'æ­£æœˆåˆä¹', m: null },
                '2026-02-26': { d: 'æ­£æœˆåˆå', m: null },
                '2026-02-27': { d: 'æ­£æœˆåä¸€', m: null },
                '2026-02-28': { d: 'æ­£æœˆåäºŒ', m: null },
                '2026-03-01': { d: 'æ­£æœˆåä¸‰', m: 'å¼€å­¦', icon: <Flag size={12} /> }
            };

            // --- Date Helpers ---
            const formatDate = (date) => {
                const y = date.getFullYear();
                const m = String(date.getMonth() + 1).padStart(2, '0');
                const d = String(date.getDate()).padStart(2, '0');
                return `${y}-${m}-${d}`;
            };

            const parseDate = (str) => {
                const [y, m, d] = str.split('-').map(Number);
                return new Date(y, m - 1, d);
            };

            // --- State ---
            const [tasks, setTasks] = useState(() => {
                // å°è¯•ä» localStorage è¯»å–æ•°æ®ï¼Œå®ç°åˆ·æ–°ä¸ä¸¢å¤±
                // ä½¿ç”¨åŸºäºæ–‡ä»¶åçš„åŠ¨æ€å­˜å‚¨é”®
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) return JSON.parse(saved);
                return [
                    { id: '1', title: 'è‹±è¯­å£è¯­è¯¾', color: 'blue', date: '2026-01-19', startTime: '10:00', endTime: '12:30', completed: false, order: 0 },
                    { id: '2', title: 'å¯’å‡ä½œä¸š', color: 'green', date: '2026-01-19', startTime: '14:00', endTime: '15:30', completed: false, order: 1 },
                    { id: '3', title: 'ç¾½æ¯›çƒç»ƒä¹ ', color: 'orange', date: '2026-01-19', startTime: '16:00', endTime: '17:00', completed: false, order: 2 },
                ];
            });

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            useEffect(() => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
            }, [tasks]);

            const [selectedDate, setSelectedDate] = useState('2026-01-19');
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isBatchMode, setIsBatchMode] = useState(false);
            const [editingTask, setEditingTask] = useState(null);
            const [draggedTaskId, setDraggedTaskId] = useState(null);
            const [showBatchPreview, setShowBatchPreview] = useState(false);

            const [formData, setFormData] = useState({
                title: '',
                color: 'blue',
                startTime: '10:00',
                endTime: '12:00',
                startDate: '2026-01-19',
                endDate: '2026-01-30',
                selectedDays: [1, 2, 3, 4, 5]
            });

            // --- Derived State ---
            const dates = useMemo(() => {
                const d = [];
                let current = parseDate(START_DATE_STR);
                const end = parseDate(END_DATE_STR);
                while (current <= end) {
                    d.push(formatDate(current));
                    current.setDate(current.getDate() + 1);
                }
                return d;
            }, []);

            const currentDayTasks = useMemo(() => {
                return tasks
                    .filter(t => t.date === selectedDate)
                    .sort((a, b) => (a.order || 0) - (b.order || 0));
            }, [tasks, selectedDate]);

            // Batch tasks overview - group tasks by title to show batch scheduling patterns
            const batchTasksOverview = useMemo(() => {
                const grouped = {};
                tasks.forEach(task => {
                    if (!grouped[task.title]) {
                        grouped[task.title] = {
                            title: task.title,
                            color: task.color,
                            startTime: task.startTime,
                            endTime: task.endTime,
                            dates: [],
                            count: 0
                        };
                    }
                    grouped[task.title].dates.push(task.date);
                    grouped[task.title].count++;
                });

                // Convert to array and calculate date ranges
                return Object.values(grouped)
                    .filter(item => item.count > 1) // Only show tasks that appear multiple times
                    .map(item => {
                        const sortedDates = item.dates.sort();
                        return {
                            ...item,
                            startDate: sortedDates[0],
                            endDate: sortedDates[sortedDates.length - 1],
                            dates: sortedDates
                        };
                    })
                    .sort((a, b) => a.startDate.localeCompare(b.startDate));
            }, [tasks]);

            // --- Handlers ---
            const handleSave = () => {
                if (!formData.title) return;

                if (isBatchMode) {
                    const newBatchTasks = [];
                    let current = parseDate(formData.startDate);
                    const end = parseDate(formData.endDate);
                    while (current <= end) {
                        if (formData.selectedDays.includes(current.getDay())) {
                            newBatchTasks.push({
                                id: Math.random().toString(36).substr(2, 9),
                                title: formData.title,
                                color: formData.color,
                                date: formatDate(current),
                                startTime: formData.startTime,
                                endTime: formData.endTime,
                                completed: false,
                                order: Date.now() + Math.random()
                            });
                        }
                        current.setDate(current.getDate() + 1);
                    }
                    setTasks(prev => [...prev, ...newBatchTasks]);
                } else {
                    if (editingTask) {
                        setTasks(prev => prev.map(t => t.id === editingTask.id ? { ...t, ...formData } : t));
                    } else {
                        setTasks(prev => [...prev, {
                            ...formData,
                            id: Math.random().toString(36).substr(2, 9),
                            date: selectedDate,
                            completed: false,
                            order: Date.now()
                        }]);
                    }
                }
                setIsModalOpen(false);
                setEditingTask(null);
            };

            // --- Sorting Interaction ---
            const handleTaskDragStart = (id) => setDraggedTaskId(id);

            const handleTaskDrop = (targetId) => {
                if (draggedTaskId === targetId) return;
                const dayTasks = [...currentDayTasks];
                const draggedIdx = dayTasks.findIndex(t => t.id === draggedTaskId);
                const targetIdx = dayTasks.findIndex(t => t.id === targetId);

                if (draggedIdx === -1 || targetIdx === -1) return;

                const [removed] = dayTasks.splice(draggedIdx, 1);
                dayTasks.splice(targetIdx, 0, removed);

                // Update global tasks with new orders for this day
                const updatedTasks = tasks.map(t => {
                    if (t.date === selectedDate) {
                        const newIdx = dayTasks.findIndex(dt => dt.id === t.id);
                        if (newIdx !== -1) {
                            return { ...t, order: newIdx };
                        }
                    }
                    return t;
                });
                setTasks(updatedTasks);
                setDraggedTaskId(null);
            };

            return (
                <div className="min-h-screen bg-[#f1f5f9] text-slate-900 p-4 md:p-8 font-sans">
                    <div className="max-w-7xl mx-auto">

                        {/* Header */}
                        <header className="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-6">
                            <div>
                                <div className="flex items-center gap-3 mb-2">
                                    <h1 className="text-4xl font-black text-slate-800 tracking-tighter">2026 å¯’å‡æ—¥ç¨‹è§†è§‰ç®¡ç†</h1>
                                    <div className="px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-2xl shadow-lg">
                                        <span className="text-xs font-black uppercase tracking-widest">ğŸ“š {DISPLAY_NAME}</span>
                                    </div>
                                </div>
                                <div className="flex flex-wrap gap-4 mt-2">
                                    {Object.entries(COLOR_CONFIG).map(([key, cfg]) => (
                                        <div key={key} className="flex items-center gap-1.5">
                                            <div className={`w-3 h-3 rounded-full ${cfg.dot}`} />
                                            <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">{cfg.label}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            <div className="flex gap-3">
                                <button onClick={() => {
                                    if (window.confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                                        setTasks([]);
                                        localStorage.removeItem(STORAGE_KEY);
                                        setShowBatchPreview(false);
                                    }
                                }} className="flex items-center gap-2 bg-red-50 text-red-600 border-2 border-red-200 px-4 py-3 rounded-2xl font-bold hover:bg-red-100 shadow-lg active:scale-95 transition-all">
                                    <Trash2 size={18} /> æ¸…é™¤æ•°æ®
                                </button>
                                <button onClick={() => setShowBatchPreview(!showBatchPreview)} className={`flex items-center gap-2 px-6 py-3 rounded-2xl font-bold shadow-lg active:scale-95 transition-all ${showBatchPreview ? 'bg-purple-600 text-white hover:bg-purple-700' : 'bg-white text-purple-600 border-2 border-purple-600 hover:bg-purple-50'}`}>
                                    <BarChart3 size={18} /> æ‰¹é‡é¢„è§ˆ
                                </button>
                                <button onClick={() => { setIsBatchMode(true); setIsModalOpen(true); }} className="flex items-center gap-2 bg-indigo-600 text-white px-6 py-3 rounded-2xl font-bold hover:bg-indigo-700 shadow-lg active:scale-95 transition-all">
                                    <Repeat size={18} /> æ‰¹é‡æ’è¯¾
                                </button>
                                <button onClick={() => { setEditingTask(null); setIsBatchMode(false); setIsModalOpen(true); }} className="flex items-center gap-2 bg-slate-900 text-white px-6 py-3 rounded-2xl font-bold hover:bg-slate-800 shadow-lg active:scale-95 transition-all">
                                    <Plus size={18} /> æ–°å¢è®¡åˆ’
                                </button>
                            </div>
                        </header>

                        {/* Batch Preview Panel */}
                        {showBatchPreview && (
                            <div className="mb-8 bg-gradient-to-br from-purple-50 to-indigo-50 rounded-[2rem] shadow-xl shadow-purple-200/60 border-2 border-purple-200 overflow-hidden animate-in slide-in-from-top duration-300">
                                <div className="p-6 bg-white/60 backdrop-blur-sm border-b border-purple-200 flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 bg-purple-600 rounded-2xl flex items-center justify-center">
                                            <BarChart3 size={20} className="text-white" />
                                        </div>
                                        <div>
                                            <h2 className="font-black text-slate-800 text-xl tracking-tight">æ‰¹é‡æ’è¯¾æ€»è§ˆ</h2>
                                            <p className="text-xs text-slate-500 font-bold">æŸ¥çœ‹æ‰€æœ‰é‡å¤æ€§è¯¾ç¨‹çš„æ—¶é—´å‘¨æœŸå’Œå†…å®¹</p>
                                        </div>
                                    </div>
                                    <button onClick={() => setShowBatchPreview(false)} className="w-8 h-8 rounded-full bg-white/80 flex items-center justify-center text-slate-400 hover:bg-white hover:text-slate-600 transition-all">
                                        <X size={18} />
                                    </button>
                                </div>

                                <div className="p-6">
                                    {batchTasksOverview.length === 0 ? (
                                        <div className="py-16 text-center border-4 border-dashed border-purple-200 rounded-[2rem] bg-white/40">
                                            <div className="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center text-purple-300 mx-auto mb-4">
                                                <Repeat size={32} />
                                            </div>
                                            <p className="text-slate-500 font-black uppercase tracking-widest text-sm">æš‚æ— æ‰¹é‡æ’è¯¾è®°å½•</p>
                                            <p className="text-slate-400 text-xs mt-2">ä½¿ç”¨"æ‰¹é‡æ’è¯¾"åŠŸèƒ½åˆ›å»ºé‡å¤æ€§è¯¾ç¨‹</p>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {batchTasksOverview.map((item, idx) => {
                                                const cfg = COLOR_CONFIG[item.color];
                                                const startDateObj = parseDate(item.startDate);
                                                const endDateObj = parseDate(item.endDate);
                                                const duration = Math.ceil((endDateObj - startDateObj) / (1000 * 60 * 60 * 24)) + 1;

                                                return (
                                                    <div key={idx} className={`relative p-5 rounded-2xl border-l-[6px] ${cfg.bg} ${cfg.border} border shadow-md hover:shadow-xl transition-all group`}>
                                                        {/* Delete button for this batch course */}
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                if (window.confirm(`ç¡®å®šè¦åˆ é™¤æ‰€æœ‰"${item.title}"è¯¾ç¨‹å—ï¼Ÿå…± ${item.count} æ¬¡è¯¾ç¨‹å°†è¢«åˆ é™¤ã€‚`)) {
                                                                    setTasks(prev => prev.filter(t => t.title !== item.title));
                                                                }
                                                            }}
                                                            className="absolute top-3 right-3 w-8 h-8 bg-white/80 hover:bg-red-50 rounded-xl flex items-center justify-center text-slate-400 hover:text-red-600 transition-all opacity-0 group-hover:opacity-100 shadow-sm z-10"
                                                        >
                                                            <Trash2 size={16} />
                                                        </button>

                                                        <div className="flex items-start justify-between mb-3">
                                                            <div className="flex-grow pr-8">
                                                                <h3 className={`text-lg font-black ${cfg.text} mb-1`}>{item.title}</h3>
                                                                <div className={`flex items-center gap-1.5 text-xs font-bold ${cfg.text} opacity-70`}>
                                                                    <Clock size={12} />
                                                                    {item.startTime} - {item.endTime}
                                                                </div>
                                                            </div>
                                                            <div className={`w-8 h-8 rounded-full ${cfg.dot} flex items-center justify-center text-white text-xs font-black`}>
                                                                {item.count}
                                                            </div>
                                                        </div>

                                                        <div className="space-y-2 mt-4 pt-4 border-t border-slate-200/50">
                                                            <div className="flex items-center justify-between text-xs">
                                                                <span className="text-slate-500 font-bold">å¼€å§‹æ—¥æœŸ</span>
                                                                <span className="font-black text-slate-700">
                                                                    {item.startDate.split('-')[1]}æœˆ{item.startDate.split('-')[2]}æ—¥
                                                                </span>
                                                            </div>
                                                            <div className="flex items-center justify-between text-xs">
                                                                <span className="text-slate-500 font-bold">ç»“æŸæ—¥æœŸ</span>
                                                                <span className="font-black text-slate-700">
                                                                    {item.endDate.split('-')[1]}æœˆ{item.endDate.split('-')[2]}æ—¥
                                                                </span>
                                                            </div>
                                                            <div className="flex items-center justify-between text-xs">
                                                                <span className="text-slate-500 font-bold">æ—¶é—´è·¨åº¦</span>
                                                                <span className="font-black text-slate-700">{duration} å¤©</span>
                                                            </div>
                                                            <div className="flex items-center justify-between text-xs">
                                                                <span className="text-slate-500 font-bold">æ€»è¯¾æ—¶</span>
                                                                <span className={`font-black ${cfg.text}`}>{item.count} æ¬¡</span>
                                                            </div>
                                                        </div>

                                                        {/* Mini calendar visualization */}
                                                        <div className="mt-4 pt-4 border-t border-slate-200/50">
                                                            <div className="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-2">è¯¾ç¨‹åˆ†å¸ƒ</div>
                                                            <div className="flex flex-wrap gap-1">
                                                                {item.dates.slice(0, 12).map((date, i) => (
                                                                    <div key={i} className={`w-6 h-6 rounded-lg ${cfg.dot} opacity-60 flex items-center justify-center text-white text-[9px] font-bold`}>
                                                                        {parseDate(date).getDate()}
                                                                    </div>
                                                                ))}
                                                                {item.dates.length > 12 && (
                                                                    <div className="w-6 h-6 rounded-lg bg-slate-300 flex items-center justify-center text-white text-[8px] font-bold">
                                                                        +{item.dates.length - 12}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">

                            {/* Calendar Section */}
                            <div className="lg:col-span-5 bg-white rounded-[2rem] shadow-xl shadow-slate-200/60 border border-slate-100 overflow-hidden">
                                <div className="p-6 bg-slate-50/50 border-b border-slate-100 flex items-center justify-between">
                                    <h2 className="font-black text-slate-700 flex items-center gap-2 uppercase tracking-tight">
                                        <Calendar size={20} className="text-indigo-600" />
                                        å¯’å‡å…¨æ™¯
                                    </h2>
                                </div>

                                <div className="p-4 md:p-6">
                                    <div className="grid grid-cols-7 mb-4 text-center text-[11px] font-black text-slate-400 uppercase tracking-widest">
                                        {['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'].map(day => <div key={day}>{day}</div>)}
                                    </div>

                                    <div className="grid grid-cols-7 gap-1.5">
                                        {dates.map((dateString) => {
                                            const isSelected = selectedDate === dateString;
                                            const dateObj = parseDate(dateString);
                                            const lunar = LUNAR_MAP[dateString] || { d: 'å†œå†' };
                                            const dayTasks = tasks.filter(t => t.date === dateString);

                                            return (
                                                <div
                                                    key={dateString}
                                                    onClick={() => setSelectedDate(dateString)}
                                                    className={`
                                    relative min-h-[75px] flex flex-col items-center justify-start rounded-2xl cursor-pointer transition-all border-2 py-2 px-1
                                    ${isSelected ? 'bg-indigo-600 border-indigo-600 shadow-xl shadow-indigo-200 -translate-y-1' : 'bg-white border-transparent hover:bg-slate-50'}
                                `}
                                                >
                                                    <span className={`text-xl font-black leading-none mb-1 ${isSelected ? 'text-white' : 'text-slate-800'}`}>
                                                        {dateObj.getDate()}
                                                    </span>
                                                    <div className={`text-[9px] font-bold leading-none mb-2 truncate max-w-full text-center ${isSelected ? 'text-indigo-200' : (lunar.m ? 'text-orange-500' : 'text-slate-400')}`}>
                                                        {lunar.m || lunar.d.replace('è…Šæœˆ', '').replace('æ­£æœˆ', '')}
                                                    </div>

                                                    {/* Visual Color Stripes */}
                                                    <div className="w-full space-y-0.5 mt-auto pb-1">
                                                        {dayTasks.slice(0, 4).map((t, idx) => (
                                                            <div
                                                                key={t.id}
                                                                className={`h-1 w-full rounded-full ${COLOR_CONFIG[t.color || 'blue'].dot} opacity-80`}
                                                            />
                                                        ))}
                                                        {dayTasks.length > 4 && (
                                                            <div className={`text-[8px] font-black text-center ${isSelected ? 'text-white' : 'text-slate-400'}`}>
                                                                +{dayTasks.length - 4}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>

                            {/* Task List Section */}
                            <div className="lg:col-span-7 space-y-6">
                                <div className="bg-white rounded-[2rem] shadow-xl shadow-slate-200/60 border border-slate-100 p-8 min-h-[600px]">
                                    <div className="flex items-center gap-3 mb-8">
                                        <div className="w-1.5 h-10 bg-indigo-600 rounded-full" />
                                        <div>
                                            <div className="text-[11px] font-black text-slate-400 uppercase tracking-widest">
                                                {LUNAR_MAP[selectedDate]?.d} {LUNAR_MAP[selectedDate]?.m && `Â· ${LUNAR_MAP[selectedDate]?.m}`}
                                            </div>
                                            <h3 className="text-4xl font-black text-slate-800 tracking-tighter">
                                                {selectedDate.split('-')[1]}æœˆ{selectedDate.split('-')[2]}æ—¥
                                            </h3>
                                        </div>
                                    </div>

                                    <div className="space-y-4">
                                        {currentDayTasks.length === 0 ? (
                                            <div className="py-32 text-center border-4 border-dashed border-slate-50 rounded-[2rem] flex flex-col items-center gap-4">
                                                <div className="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center text-slate-200">
                                                    <Layout size={40} />
                                                </div>
                                                <p className="text-slate-400 font-black uppercase tracking-widest text-sm text-center px-4">ä»Šæ—¥æš‚æ— å®‰æ’<br />ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ è®¡åˆ’</p>
                                            </div>
                                        ) : (
                                            currentDayTasks.map((task) => (
                                                <div
                                                    key={task.id}
                                                    draggable
                                                    onDragStart={() => handleTaskDragStart(task.id)}
                                                    onDragOver={(e) => e.preventDefault()}
                                                    onDrop={() => handleTaskDrop(task.id)}
                                                    onClick={() => { setEditingTask(task); setFormData({ ...task }); setIsBatchMode(false); setIsModalOpen(true); }}
                                                    className={`
                                    group relative flex items-center gap-4 p-5 rounded-2xl border-l-[8px] transition-all cursor-pointer border shadow-sm hover:shadow-lg hover:-translate-y-0.5
                                    ${COLOR_CONFIG[task.color].bg} ${COLOR_CONFIG[task.color].border}
                                    ${task.completed ? 'opacity-40 grayscale-[0.5]' : ''}
                                `}
                                                >
                                                    <div className="flex-shrink-0 cursor-grab active:cursor-grabbing text-slate-300 group-hover:text-slate-400 transition-colors">
                                                        <GripVertical size={20} />
                                                    </div>
                                                    <button
                                                        onClick={(e) => { e.stopPropagation(); setTasks(tasks.map(t => t.id === task.id ? { ...t, completed: !t.completed } : t)); }}
                                                        className={`w-7 h-7 rounded-full border-2 flex items-center justify-center transition-all ${task.completed ? 'bg-indigo-600 border-indigo-600 shadow-md' : 'bg-white border-slate-300 hover:border-indigo-400'}`}
                                                    >
                                                        {task.completed && <CheckCircle2 size={16} className="text-white" />}
                                                    </button>

                                                    <div className="flex-grow">
                                                        <h4 className={`text-xl font-black ${task.completed ? 'line-through text-slate-400' : 'text-slate-800'}`}>
                                                            {task.title}
                                                        </h4>
                                                        <div className={`flex items-center gap-2 text-xs font-black uppercase tracking-tight mt-1 opacity-60 ${COLOR_CONFIG[task.color].text}`}>
                                                            <Clock size={14} /> {task.startTime} â€” {task.endTime}
                                                        </div>
                                                    </div>

                                                    <div className="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                                        <button onClick={(e) => { e.stopPropagation(); setTasks(tasks.filter(t => t.id !== task.id)); }} className="p-3 bg-white/80 rounded-xl text-red-400 hover:text-red-600 hover:bg-white shadow-sm transition-all">
                                                            <Trash2 size={20} />
                                                        </button>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Unified Modal */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300">
                            <div className="bg-white rounded-[2.5rem] p-10 w-full max-w-xl shadow-2xl relative border border-slate-100 overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500" />

                                <div className="flex justify-between items-center mb-8">
                                    <h3 className="text-3xl font-black text-slate-800 tracking-tighter">
                                        {isBatchMode ? 'æ‰¹é‡è§„åˆ’è¯¾è¡¨' : (editingTask ? 'ä¿®æ”¹æ—¥ç¨‹' : 'æ–°å¢è®¡åˆ’')}
                                    </h3>
                                    <button onClick={() => setIsModalOpen(false)} className="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 hover:bg-slate-100 transition-all">
                                        <X size={24} />
                                    </button>
                                </div>

                                <div className="space-y-6">
                                    <div className="space-y-2">
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-1">åç§°</label>
                                        <input className="w-full p-5 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-indigo-500 focus:bg-white outline-none font-bold text-slate-700 transition-all" value={formData.title} onChange={e => setFormData({ ...formData, title: e.target.value })} placeholder="ä¾‹å¦‚ï¼šè‹±è¯­è¯¾ã€è·³ç»³ã€ä¹¦æ³•" />
                                    </div>

                                    <div className="space-y-3">
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-1">åˆ†ç±»é¢œè‰²</label>
                                        <div className="grid grid-cols-5 gap-3">
                                            {Object.entries(COLOR_CONFIG).map(([key, cfg]) => (
                                                <button
                                                    key={key}
                                                    onClick={() => setFormData({ ...formData, color: key })}
                                                    className={`h-12 rounded-2xl border-2 flex flex-col items-center justify-center gap-1 transition-all ${formData.color === key ? `${cfg.border} bg-white shadow-lg shadow-slate-100 scale-105` : 'border-slate-50 bg-slate-50 opacity-60'}`}
                                                >
                                                    <div className={`w-4 h-4 rounded-full ${cfg.dot}`} />
                                                    <span className="text-[8px] font-black uppercase">{cfg.label}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {isBatchMode && (
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="space-y-2">
                                                <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-1">å¼€å§‹æ—¥æœŸ</label>
                                                <input type="date" className="w-full p-4 bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none" value={formData.startDate} onChange={e => setFormData({ ...formData, startDate: e.target.value })} />
                                            </div>
                                            <div className="space-y-2">
                                                <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-1">ç»“æŸæ—¥æœŸ</label>
                                                <input type="date" className="w-full p-4 bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none" value={formData.endDate} onChange={e => setFormData({ ...formData, endDate: e.target.value })} />
                                            </div>
                                        </div>
                                    )}

                                    {isBatchMode && (
                                        <div className="space-y-3 p-4 bg-slate-50 rounded-[2rem]">
                                            <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block text-center mb-1">é‡å¤æ˜ŸæœŸ</label>
                                            <div className="flex justify-between px-2">
                                                {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map((day, idx) => (
                                                    <button
                                                        key={idx}
                                                        onClick={() => setFormData(prev => ({
                                                            ...prev,
                                                            selectedDays: prev.selectedDays.includes(idx) ? prev.selectedDays.filter(d => d !== idx) : [...prev.selectedDays, idx]
                                                        }))}
                                                        className={`w-10 h-10 rounded-full font-black text-sm transition-all ${formData.selectedDays.includes(idx) ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-200' : 'bg-white text-slate-400'}`}
                                                    >
                                                        {day}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="space-y-2">
                                            <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-1">å¼€å§‹æ—¶é—´</label>
                                            <input type="time" className="w-full p-4 bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none" value={formData.startTime} onChange={e => setFormData({ ...formData, startTime: e.target.value })} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-1">ç»“æŸæ—¶é—´</label>
                                            <input type="time" className="w-full p-4 bg-slate-50 rounded-2xl font-bold text-slate-700 outline-none" value={formData.endTime} onChange={e => setFormData({ ...formData, endTime: e.target.value })} />
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-4 mt-10">
                                    <button onClick={() => setIsModalOpen(false)} className="flex-1 py-5 font-black text-slate-400 hover:text-slate-600 transition-all uppercase tracking-widest">å–æ¶ˆ</button>
                                    <button onClick={handleSave} className="flex-[2] py-5 bg-slate-900 text-white rounded-3xl font-black shadow-xl shadow-slate-200 hover:bg-indigo-600 active:scale-95 transition-all uppercase tracking-widest">
                                        {editingTask ? 'ä¿å­˜ä¿®æ”¹' : (isBatchMode ? 'ç”Ÿæˆè¯¾è¡¨' : 'ä¿å­˜è®¡åˆ’')}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<App />);
    </script>
</body>

</html>